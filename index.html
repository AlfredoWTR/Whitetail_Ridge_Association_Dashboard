<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>HOA Members Dashboard</title>
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <style>
    body { font-family: Arial, sans-serif; margin:0; padding:0; background:#f5f5f5; }
    header { background:#2c3e50; color:white; padding:1rem; text-align:center; }
    nav { display:flex; background:#34495e; }
    nav button { flex:1; padding:1rem; background:none; border:none; color:white; cursor:pointer; }
    nav button.active { background:#1abc9c; }
    .content { padding:1rem; display:none; }
    .content.active { display:block; }
    .chart-container { width:100%; max-width:800px; margin: 2rem auto; background:white; padding:1rem; border-radius:10px; box-shadow:0 2px 6px rgba(0,0,0,0.2); }
    .document-list { list-style:none; padding:0; }
    .document-list li { margin-bottom:0.5rem; }
    .login-container { display:flex; flex-direction:column; align-items:center; justify-content:center; height:100vh; }
    .login-container input { padding:0.5rem; margin:0.5rem; width:200px; }
    .login-container button { padding:0.5rem 1rem; background:#1abc9c; border:none; color:white; cursor:pointer; }
  </style>
</head>
<body>

<div id="login" class="login-container">
  <h2>HOA Members Login</h2>
  <input type="password" id="password" placeholder="Enter password">
  <button onclick="checkPassword()">Login</button>
</div>

<div id="dashboard" style="display:none;">
  <header>
    <h1>HOA Members Dashboard</h1>
  </header>
  <nav>
    <button class="tab-btn active" onclick="showTab('finance')">Finance</button>
    <button class="tab-btn" onclick="showTab('bylaws')">Bylaws</button>
    <button class="tab-btn" onclick="showTab('documents')">Documents</button>
    <button class="tab-btn" onclick="showTab('announcements')">Announcements</button>
  </nav>

  <div id="finance" class="content active">
    <div class="chart-container">
      <canvas id="budgetChart"></canvas>
    </div>
    <div class="chart-container">
      <canvas id="trendChart"></canvas>
    </div>
  </div>

  <div id="bylaws" class="content">
    <ul class="document-list" id="bylaws-list">
      <!-- Populate dynamically -->
    </ul>
  </div>

  <div id="documents" class="content">
    <ul class="document-list" id="docs-list">
      <!-- Populate dynamically -->
    </ul>
  </div>

  <div id="announcements" class="content">
    <div id="announcements-list">
      <!-- Populate dynamically -->
      <p>No announcements yet.</p>
    </div>
  </div>
</div>

<script>
  // ======= PASSWORD PROTECTION =======
  const PASSWORD = "HOAMembers123"; // <-- Change to your own password
  function checkPassword() {
    const input = document.getElementById('password').value;
    if(input === PASSWORD) {
      document.getElementById('login').style.display = 'none';
      document.getElementById('dashboard').style.display = 'block';
    } else {
      alert('Incorrect password');
    }
  }

  // ======= TAB NAVIGATION =======
  function showTab(tabId) {
    document.querySelectorAll('.content').forEach(c => c.classList.remove('active'));
    document.getElementById(tabId).classList.add('active');
    document.querySelectorAll('nav button').forEach(b => b.classList.remove('active'));
    document.querySelector(`button[onclick="showTab('${tabId}')"]`).classList.add('active');
  }

  // ======= FINANCE CHARTS =======
  async function fetchFinanceData() {
    // Replace this with your Google Sheet published CSV URL
    const sheetCSV = 'YOUR_GOOGLE_SHEET_CSV_URL';
    const res = await fetch(sheetCSV);
    const text = await res.text();
    const rows = text.split('\n').map(r => r.split(','));
    const headers = rows[0];
    const data = rows.slice(1).filter(r => r.length > 1);

    const categories = [];
    const budgets = [];
    const actuals = [];
    const fiscalYears = [];

    data.forEach(row => {
      const obj = {};
      headers.forEach((h,i)=> obj[h.trim()]=row[i]);
      if(!categories.includes(obj['Category'])) categories.push(obj['Category']);
      budgets.push(parseFloat(obj['Budget']) || 0);
      actuals.push(parseFloat(obj['Actual']) || 0);
      fiscalYears.push(obj['Fiscal Year']);
    });

    return {categories, budgets, actuals, fiscalYears};
  }

  async function renderCharts() {
    const finance = await fetchFinanceData();

    // Budget vs Actual by Category
    const ctx = document.getElementById('budgetChart').getContext('2d');
    new Chart(ctx, {
      type: 'bar',
      data: {
        labels: finance.categories,
        datasets: [
          {label:'Budget', data: finance.budgets, backgroundColor:'#1abc9c'},
          {label:'Actual', data: finance.actuals, backgroundColor:'#e74c3c'}
        ]
      },
      options: { responsive:true, plugins:{legend:{position:'top'}} }
    });

    // Trends over Fiscal Years (simple sum)
    const yearMap = {};
    finance.fiscalYears.forEach((y,i)=>{
      if(!yearMap[y]) yearMap[y]={budget:0, actual:0};
      yearMap[y].budget += finance.budgets[i];
      yearMap[y].actual += finance.actuals[i];
    });
    const years = Object.keys(yearMap);
    const yearBudgets = years.map(y=>yearMap[y].budget);
    const yearActuals = years.map(y=>yearMap[y].actual);

    const ctx2 = document.getElementById('trendChart').getContext('2d');
    new Chart(ctx2, {
      type: 'line',
      data: {
        labels: years,
        datasets:[
          {label:'Budget', data:yearBudgets, borderColor:'#1abc9c', fill:false},
          {label:'Actual', data:yearActuals, borderColor:'#e74c3c', fill:false}
        ]
      },
      options:{responsive:true, plugins:{legend:{position:'top'}}}
    });
  }

  renderCharts();

  // ======= DOCUMENTS =======
  const bylawsDocs = [
    {name:'Bylaws.pdf', url:'YOUR_GOOGLE_DRIVE_LINK'},
    {name:'Rules.pdf', url:'YOUR_GOOGLE_DRIVE_LINK'}
  ];
  const otherDocs = [
    {name:'2025 Budget.pdf', url:'YOUR_GOOGLE_DRIVE_LINK'},
    {name:'Meeting Minutes.pdf', url:'YOUR_GOOGLE_DRIVE_LINK'}
  ];

  const bylawsList = document.getElementById('bylaws-list');
  bylawsDocs.forEach(d=>{
    const li = document.createElement('li');
    li.innerHTML = `<a href="${d.url}" target="_blank">${d.name}</a>`;
    bylawsList.appendChild(li);
  });

  const docsList = document.getElementById('docs-list');
  otherDocs.forEach(d=>{
    const li = document.createElement('li');
    li.innerHTML = `<a href="${d.url}" target="_blank">${d.name}</a>`;
    docsList.appendChild(li);
  });
</script>

</body>
</html>
